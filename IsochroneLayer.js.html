<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: layers/IsochroneLayer.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: layers/IsochroneLayer.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>require("./layers");
require("./SingleLayer.js");


/**
 * Wrapper for [Leaflet's WMS layer]{@link http://leafletjs.com/reference.html#tilelayer-wms } so its integrated in the SMC's viewer layer architecture.
 *
 * @class
 * @extends L.TileLayer.WMS
 * @mixes SMC.layers.SingleLayer
 *
 * @author Luis Rom√°n (lroman@emergya.com)
 */
SMC.layers.IsochroneLayer = SMC.layers.geometry.WFSGeometryLayer.extend(
    /** @lends SMC.layers.WMSLayer# */
    {
        /**
        * @typedef {Object} SMC.layers.IsochroneLayer~options
        * @property {SMC.layers.IsochroneLayer~requestParams} requestParams - Default wfs request parameters
        * @property {string} serverURL=null - The wfs server url path parameter
        */

         options: {
            /** @typedef {Object} SMC.layers.IsochroneLayer~requestParams - Default wfs request parameters 
             * @property {string} batch="true" - Goal direction is turned off
             * @property {string} walTime=null - Default travel time  
             * @property {string} styles="color30" - Default styles
             * @property {string} mode="WALK" - Default travel mode
             * @property {string} maxWalkDistance=null - Default maximun travel distance
             * @property {string} time=null - Default time
             * @property {string} arriveBy="false" - By default trip should depart at the specified date and time
             * @property {string} walkSpeed=null - Default walk speed
             * @property {string} bikeSpedd=null - Default bike speed 
             * @property {string} output="SHED" - Default output geometry
             * @property {string} outputFormat="text/javascript" - Default wfs output format parameter

              */
                requestParams:{
                    batch: "true",
                    walkTime: "15",
                    styles: "color30",
                    mode: "WALK",
                    maxWalkDistance: null,
                    time: null,
                    fromPlace: null,
                    toPlace:"none", 
                    arriveBy: "false",
                    walkSpeed: null,
                    bikeSpeed: null, 
                    output: "SHED",
                    outputFormat: "text/javascript",

                },
                serverURL: 'http://107.170.88.62:8080/opentripplanner-api-webapp/ws/iso'
            },

        _getDate: function(){
            var today = new Date();
            var dd = today.getDate();
            var mm = today.getMonth()+1; 
            var yyyy = today.getFullYear();
            var hh = today.getHours();
            var mi = today.getMinutes();
            var ss = today.getSeconds();

            if(dd&lt;10) {
                dd='0'+dd;
            } 
            if(mm&lt;10) {
                mm='0'+mm;
            } 
            if(hh&lt;10) {
                hh='0'+hh;
            } 
            if(mi&lt;10) {
                mi='0'+mi;
            } 
            if(ss&lt;10) {
                ss='0'+ss;
            } 


            today = yyyy+'-'+mm+'-'+dd + 'T' +hh +':'+ mi +':' +ss;
            this.options.time = today;
        },



         /**
         * Initialize the object with the params
         * @param {object} options - object with need parameters
         */
        initialize: function(options) {
            if(this.options.time == null){
                this._getDate();
            }
            if(!options.serverURL){
                options.serverURL = this.options.serverURL;
            }
            if (typeof(options.serverURL) !== "string") {
                throw new Error("SMC.layers.IsochroneLayer::initialize: options must contain an url attribute of type string.");
            }
            SMC.layers.geometry.WFSGeometryLayer.prototype.initialize.call(this, options.serverURL, options);
            SMC.layers.SingleLayer.prototype.initialize.call(this, options);
        },

        /**
         * Method to load the control in the map
         * @param {SMC.Map} map - Map to be added
         */
        onAdd: function(map) {
           SMC.layers.geometry.WFSGeometryLayer.prototype.onAdd.call(this, map);
           
        },

         /**
         * Method to get the map
         * @returns {SMC.Map} map - Map layer
         */
        getMap: function() {
            return this._map;
        },

       
        load:function(){
            var self = this;
            this.doFeaturesLoading().then(function(response){
                var output = [];
                for(var i in response.coordinates){
                    var feature = {};
                    feature.type = 'Feature';
                    feature.geometry ={};
                    feature.geometry.type = response.type;
                    feature.geometry.coordinates = response.coordinates[i];
                    output.push(feature);
                }

                self.onFeaturesLoaded(output);

            });

        },

         doFeaturesLoading: function(){
            var self = this;
            var jsonpRandom = this._makeid();
            this.options.format_options = "callback:" + jsonpRandom;
            var stylesheet = '*{fillColor: "rgba(43,140,190,0.5)"; color: "rgba(43,140,190,0.5)";}';
            if(!this.options.stylesheet){
                this.options.stylesheet = stylesheet;
            }
           return $.ajax({
                type: 'GET',
                url: self.options.serverURL, 
                data: self.getParamsFromOptions(), 
                jsonpCallback: jsonpRandom,
                dataType: "jsonp",
                async: false,
               
          });

      
        },

      
  
         /**
         * Method to unload the layer.
         */
        unload: function() {
            this._needsload = true;
            this._reset();
        }


    }, [SMC.layers.SingleLayer]);

/**
 * API factory method for ease creation of WMS layers.
 * @params {Object} options - Options for the layer. Must contain a field url of type string.
 */
SMC.isochroneLayer = function(options) {
    return new SMC.layers.IsochroneLayer(options);
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="SMC.controls.layerTree.LayerTreeControl.html">LayerTreeControl</a></li><li><a href="SMC.controls.layerTree.LayerTreeLeaf.html">LayerTreeLeaf</a></li><li><a href="SMC.controls.layerTree.LayerTreeNode.html">LayerTreeNode</a></li><li><a href="SMC.layers.aggregation.AggregatingLayer.html">AggregatingLayer</a></li><li><a href="SMC.layers.aggregation.MultiModeLayer.html">MultiModeLayer</a></li><li><a href="SMC.layers.EditableLayer.html">EditableLayer</a></li><li><a href="SMC.layers.Folder.html">Folder</a></li><li><a href="SMC.layers.geometry.CanvasRenderer.html">CanvasRenderer</a></li><li><a href="SMC.layers.geometry.GeometryLayer.html">GeometryLayer</a></li><li><a href="SMC.layers.geometry.TiledGeometryLayer.html">TiledGeometryLayer</a></li><li><a href="SMC.layers.geometry.WFSGeometryLayer.html">WFSGeometryLayer</a></li><li><a href="SMC.layers.geometry.WFSTiledGeometryLayer.html">WFSTiledGeometryLayer</a></li><li><a href="SMC.layers.history.AggregatingHistoryLayer.html">AggregatingHistoryLayer</a></li><li><a href="SMC.layers.history.DataHistoryLayer.html">DataHistoryLayer</a></li><li><a href="SMC.layers.IsochroneLayer.html">IsochroneLayer</a></li><li><a href="SMC.layers.Layer.html">Layer</a></li><li><a href="SMC.layers.markers.AtmosphereRTMarkerLayer.html">AtmosphereRTMarkerLayer</a></li><li><a href="SMC.layers.markers.MarkerLayer.html">MarkerLayer</a></li><li><a href="SMC.layers.markers.WFSMarkerLayer.html">WFSMarkerLayer</a></li><li><a href="SMC.layers.markers.WFSTMarkerLayer.html">WFSTMarkerLayer</a></li><li><a href="SMC.layers.reloaders.AtmosphereRTReloadTrigger.html">AtmosphereRTReloadTrigger</a></li><li><a href="SMC.layers.reloaders.LayerReloader.html">LayerReloader</a></li><li><a href="SMC.layers.reloaders.ReloadTrigger.html">ReloadTrigger</a></li><li><a href="SMC.layers.reloaders.TimerReloadTrigger.html">TimerReloadTrigger</a></li><li><a href="SMC.layers.stylers.Styler.html">Styler</a></li><li><a href="SMC.layers.TileLayer.html">TileLayer</a></li><li><a href="SMC.layers.WMSLayer.html">WMSLayer</a></li><li><a href="SMC.Map.html">Map</a></li><li><a href="SMC.providers.AtmosphereConnector.html">AtmosphereConnector</a></li><li><a href="SMC.providers.AtmosphereRTFeatureProvider.html">AtmosphereRTFeatureProvider</a></li><li><a href="SMC.providers.FeatureHistory.html">FeatureHistory</a></li><li><a href="SMC.providers.FeatureHistoryProvider.html">FeatureHistoryProvider</a></li><li><a href="SMC.providers.FeaturesProvider.html">FeaturesProvider</a></li><li><a href="SMC.providers.RTFeatureProvider.html">RTFeatureProvider</a></li><li><a href="SMC.providers.URLFeatureProvider.html">URLFeatureProvider</a></li><li><a href="SMC.providers.WFSProvider.html">WFSProvider</a></li><li><a href="SMC.providers.WFSTProvider.html">WFSTProvider</a></li></ul><h3>Events</h3><ul><li><a href="SMC.layers.geometry.TiledGeometryLayer.html#event:layeradd">layeradd</a></li><li><a href="SMC.layers.geometry.WFSTiledGeometryLayer.html#event:layeradd">layeradd</a></li><li><a href="SMC.layers.reloaders.AtmosphereRTReloadTrigger.html#event:reloadTriggered">reloadTriggered</a></li><li><a href="SMC.layers.reloaders.ReloadTrigger.html#event:reloadTriggered">reloadTriggered</a></li><li><a href="SMC.layers.reloaders.TimerReloadTrigger.html#event:reloadTriggered">reloadTriggered</a></li><li><a href="SMC.providers.AtmosphereConnector.html#event:featuresLoaded">featuresLoaded</a></li><li><a href="SMC.providers.AtmosphereRTFeatureProvider.html#event:featuresLoaded">featuresLoaded</a></li><li><a href="SMC.providers.FeatureHistoryProvider.html#event:featureHistoryLoaded">featureHistoryLoaded</a></li><li><a href="SMC.providers.FeaturesProvider.html#event:featuresLoaded">featuresLoaded</a></li><li><a href="SMC.providers.RTFeatureProvider.html#event:featuresLoaded">featuresLoaded</a></li><li><a href="SMC.providers.URLFeatureProvider.html#event:featuresLoaded">featuresLoaded</a></li><li><a href="SMC.providers.WFSProvider.html#event:featuresLoaded">featuresLoaded</a></li><li><a href="SMC.providers.WFSTProvider.html#event:featuresLoaded">featuresLoaded</a></li></ul><h3>Namespaces</h3><ul><li><a href="SMC.html">SMC</a></li><li><a href="SMC.controls.html">controls</a></li><li><a href="SMC.controls.layerTree.html">layerTree</a></li><li><a href="SMC.layers.html">layers</a></li><li><a href="SMC.layers.aggregation.html">aggregation</a></li><li><a href="SMC.layers.geometry.html">geometry</a></li><li><a href="SMC.layers.history.html">history</a></li><li><a href="SMC.layers.markers.html">markers</a></li><li><a href="SMC.layers.reloaders.html">reloaders</a></li><li><a href="SMC.layers.stylers.html">stylers</a></li><li><a href="SMC.providers.html">providers</a></li></ul><h3>Mixins</h3><ul><li><a href="SMC.controls.layerTree.LayerTreeFolder.html">LayerTreeFolder</a></li><li><a href="SMC.LayerLoader.html">LayerLoader</a></li><li><a href="SMC.layers.SingleLayer.html">SingleLayer</a></li><li><a href="SMC.layers.stylers.MapCssStyler.html">MapCssStyler</a></li><li><a href="SMC.layers.stylers.MarkerCssStyler.html">MarkerCssStyler</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Mustache">Mustache</a></li><li><a href="global.html#paper">paper</a></li><li><a href="global.html#PEG">PEG</a></li><li><a href="global.html#rbush">rbush</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha9</a> on Tue Oct 28 2014 10:42:18 GMT+0100 (CET)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
